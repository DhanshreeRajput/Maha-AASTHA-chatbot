<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maha-AASTHA Portal - Mumbai Government Services</title>
    <style>
        :root {
            --bg: #F7F8FB;
            --card: #FFFFFF;
            --ink: #1F2937;
            --muted: #6B7280;
            --primary: #1E3A8A;
            --accent: #E8872E;
            --success: #0E9F6E;
            --warning: #F59E0B;
            --error: #DC2626;
            --line: #E5E7EB;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
            background: var(--bg);
            color: var(--ink);
            line-height: 1.6;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            background: var(--card);
            border-bottom: 1px solid var(--line);
            z-index: 100;
            padding: 12px 0;
        }

        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }

        .logo svg {
            width: 32px;
            height: 32px;
        }

        .nav {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .nav a {
            text-decoration: none;
            color: var(--muted);
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav a:hover, .nav a.active {
            color: var(--primary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #1E40AF;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--line);
            color: var(--ink);
        }

        .btn-secondary:hover {
            background: #D1D5DB;
        }

        /* Mobile menu */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary);
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--card);
            z-index: 200;
            padding: 24px;
            flex-direction: column;
            gap: 24px;
        }

        .mobile-menu.show {
            display: flex;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--line);
            padding-bottom: 16px;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary);
        }

        .mobile-menu-nav {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .mobile-menu-nav a {
            padding: 12px 16px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--ink);
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .mobile-menu-nav a:hover {
            background: var(--bg);
        }

        .mobile-menu-nav a.active {
            background: var(--primary);
            color: white;
        }

        /* Hero */
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, #3B82F6 100%);
            color: white;
            padding: 80px 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.3;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .hero p {
            font-size: 20px;
            margin-bottom: 32px;
            opacity: 0.9;
        }

        .hero-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Sections */
        .section {
            padding: 64px 24px;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 48px;
        }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }

        /* Grievance Form */
        .grievance-form {
            background: var(--card);
            border-radius: 16px;
            padding: 32px;
            margin: 48px 0;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }

        .form-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 32px;
            padding: 0 16px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--muted);
            cursor: pointer;
        }

        .progress-step.active {
            color: var(--primary);
        }

        .progress-step.completed {
            color: var(--success);
        }

        .progress-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--line);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .progress-step.active .progress-circle {
            background: var(--primary);
            color: white;
        }

        .progress-step.completed .progress-circle {
            background: var(--success);
            color: white;
        }

        .form-section {
            margin-bottom: 32px;
            padding: 24px;
            border: 1px solid var(--line);
            border-radius: 12px;
        }

        .form-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--ink);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 1px solid var(--line);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
            border-color: var(--error);
        }

        .error-message {
            color: var(--error);
            font-size: 12px;
            margin-top: 4px;
        }

        .required {
            color: var(--error);
        }

        .priority-chip {
            display: inline-block;
            padding: 10px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-low {
            background: #E5E7EB;
            color: #374151;
        }

        .priority-mid {
            background: #FEF3C7;
            color: #D97706;
        }

        .priority-high {
            background: #FEE2E2;
            color: #DC2626;
        }

        .file-upload {
            border: 2px dashed var(--line);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .file-upload:hover {
            border-color: var(--primary);
        }

        .file-list {
            margin-top: 16px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .file-remove {
            background: var(--error);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .confirmation-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 24px 0;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
        }

        .submit-btn:disabled {
            background: var(--line);
            color: var(--muted);
            cursor: not-allowed;
        }

        /* Quick Access */
        .quick-access {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 48px;
        }

        .quick-card {
            text-align: center;
            padding: 32px 24px;
        }

        .quick-card svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
        }

        .quick-card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .quick-card p {
            color: var(--muted);
            margin-bottom: 16px;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .feature-card {
            text-align: center;
            padding: 24px;
        }

        .feature-card svg {
            width: 40px;
            height: 40px;
            margin-bottom: 16px;
            color: var(--primary);
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            text-align: center;
        }

        .stat-card {
            padding: 32px 24px;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--muted);
            font-weight: 500;
        }

        /* About Section */
        .about-card {
            background: var(--card);
            border-radius: 20px;
            padding: 48px;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            margin-bottom: 32px;
        }

        .about-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 48px;
            align-items: center;
        }

        .about-text {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .about-description {
            font-size: 18px;
            line-height: 1.7;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .about-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
            transition: transform 0.2s;
        }

        .feature-item:hover {
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .feature-text h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 4px;
        }

        .feature-text p {
            font-size: 14px;
            color: var(--muted);
            margin: 0;
        }

        .about-visual {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .visual-card {
            background: linear-gradient(135deg, var(--primary) 0%, #3B82F6 100%);
            color: white;
            padding: 32px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.3);
        }

        .visual-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .visual-card h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .visual-card p {
            font-size: 14px;
            opacity: 0.9;
            margin: 0;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 300;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .modal h3 {
            color: var(--success);
            margin-bottom: 16px;
        }

        .modal .btn {
            margin-top: 24px;
        }

        /* Footer */
        .footer {
            background: var(--primary);
            color: white;
            padding: 24px 24px 24px;
            text-align: center;
        }

        .footer-content {
            max-width: 1280px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 32px;
            margin-bottom: 32px;
        }

        .footer-section h4 {
            margin-bottom: 16px;
        }

        .footer-section a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 24px;
            font-size: 14px;
            opacity: 0.8;
        }

        .footer a:hover img {
            opacity: 1;
        }

        /* ==================== CHATBOT STYLES ==================== */
        .chat-widget {
            position: fixed;
            bottom: 58px;
            right: 13px;
            z-index: 10000;
        }

        .chat-bubble {
            position: relative;
            background: linear-gradient(135deg, #3b5fffff 0%, #7d99f8ff 100%);
            width: 72px;
            height: 74px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(103, 105, 245, 0.4);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .chat-bubble:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(118, 120, 253, 0.6);
        }

        .chat-bubble svg {
            width: 28px;
            height: 28px;
            fill: white;
        }

        .chat-bubble img {
            width: 74px;
            height: 74px;
            object-fit: contain;
            display: block;
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 20px rgba(117, 160, 253, 0.4); }
            50% { box-shadow: 0 4px 20px rgba(132, 134, 255, 0.8); }
            100% { box-shadow: 0 4px 20px rgba(124, 153, 247, 0.4); }
        }

        .chat-window {
            position: fixed;
            bottom: 140px;
            right: 20px;
            width: 380px;
            height: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 9999;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #e6e9f0ff 0%, #092becff 100%);
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .chat-avatar {
            width: auto;
            height: auto;
            border-radius: 0;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .chat-avatar img {
            width: 72px;
            height: 72px;
            object-fit: contain;
            display: block;
        }

        .chat-header-text h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .chat-header-text p {
            font-size: 12px;
            opacity: 0.9;
        }

        .language-selector {
            display: flex;
            align-items: center;
            margin-right: 0px;
        }

        .language-dropdown {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
        }

        .language-dropdown:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .language-dropdown option {
            background: #606bfdff;
            color: white;
            padding: 5px;
        }

        .close-chat {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .close-chat:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
            max-height: 300px;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 280px;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.bot .message-content {
            background: white;
            border: 1px solid #e1e8ed;
            color: #333;
            border-bottom-left-radius: 8px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 8px;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
            text-align: right;
        }

        .message.bot .message-time {
            text-align: left;
        }

        .typing-indicator {
            display: none;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 18px;
            border-bottom-left-radius: 8px;
            max-width: 60px;
            margin-bottom: 15px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e1e8ed;
        }

        .chat-input-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e1e8ed;
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            border-color: #574bf7ff;
        }

        .send-btn {
            background: linear-gradient(135deg, #5161f1ff 0%, #858febff 100%);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .send-btn svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 8px 12px;
            border-radius: 16px;
            font-size: 11px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-action-btn:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }

        .quick-action-btn:active {
            transform: translateY(0);
        }

        .pgrs-options {
            display: flex;
            flex-direction: row;
            gap: 4px;
            margin-top: 10px;
        }

        .option-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 7px 35px;
            border-radius: 16px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .option-button:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .link-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 10px 16px;
            border-radius: 16px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 4px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .link-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .rating-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .rating-title {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            text-align: center;
            margin-bottom: 10px;
        }

        .stars-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
        }

        .star {
            width: 32px;
            height: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .star svg {
            width: 100%;
            height: 100%;
        }

        .star.empty svg {
            fill: #d1d5db;
            stroke: #9ca3af;
            stroke-width: 1;
        }

        .star.filled svg {
            fill: #fbbf24;
            stroke: #f59e0b;
            stroke-width: 1;
        }

        .star.hover svg {  
            fill: #fcd34d;
            stroke: #f59e0b;
            stroke-width: 1;
            transform: scale(1.1);
        }

        .star:hover {
            transform: scale(1.15);
        }

        .rating-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #6b7280;
            margin-top: 5px;
            padding: 0 5px;
        }

        .rating-feedback {
            text-align: center;
            margin: 10px 0;
            font-size: 13px;
            font-weight: 500;
        }

        .rating-feedback.rating-1 { color: #dc2626; }
        .rating-feedback.rating-2 { color: #ea580c; }
        .rating-feedback.rating-3 { color: #ca8a04; }
        .rating-feedback.rating-4 { color: #16a34a; }
        .rating-feedback.rating-5 { color: #059669; }

        .submit-rating-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: -15px;
            align-self: center;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .submit-rating-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .submit-rating-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: #9ca3af;
            box-shadow: none;
        }

        .suggestion-title {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 12px;
        }

        .suggestion-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .suggestion-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            color: #495057;
            text-align: left;
        }

        .suggestion-item:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .status-header {
            font-size: 16px;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 8px;
        }

        .status-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #e8f4fd;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-weight: 600;
            color: #34495e;
            font-size: 13px;
            min-width: 100px;
        }

        .status-value {
            color: #2c3e50;
            font-size: 13px;
            text-align: right;
            font-weight: 500;
        }

        .status-value.highlight {
            background: #e8f5e8;
            padding: 3px 8px;
            border-radius: 6px;
            color: #27ae60;
            font-weight: bold;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .header-content {
                padding: 0 16px;
            }
            
            .nav {
                gap: 24px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 0 16px;
            }

            .nav {
                display: none;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .hero {
                padding: 60px 16px;
            }

            .hero h1 {
                font-size: 32px;
            }

            .hero p {
                font-size: 18px;
            }

            .hero-actions {
                flex-direction: column;
                align-items: center;
            }

            .section {
                padding: 48px 16px;
            }

            .container {
                padding: 0;
            }

            .about-content {
                grid-template-columns: 1fr;
                gap: 32px;
            }

            .about-card {
                padding: 32px 24px;
            }

            .about-features {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            .chat-window {
                right: 10px;
                left: 10px;
                width: auto;
                bottom: 80px;
            }

            .footer p {
                font-size: 12px;
                line-height: 1.4;
            }
            
            .footer span[style*="float: right"] {
                float: none !important;
                display: block;
                text-align: center;
                margin-top: 8px;
            }
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 28px;
            }

            .hero p {
                font-size: 16px;
            }

            .section {
                padding: 32px 16px;
            }

            .card {
                padding: 20px;
            }

            .stats {
                grid-template-columns: 1fr;
            }
             .form-progress {
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }

            .progress-step {
                font-size: 12px;
            }

            .grievance-form {
                padding: 20px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <div class="logo">
                <img src="logo/maha_aastha_logo.png" alt="Maha-AASTHA Logo" style="height: 36px; width: auto;">
                <span>Maha-AASTHA</span>
            </div>
            <nav class="nav" role="navigation">
                <a href="index.html">Home</a>
                <a href="grievance.html" onclick="navigateToStatus(event)">Grievance Status</a>
            </nav>
            <button class="mobile-menu-toggle" aria-label="Toggle menu">☰</button>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <div class="logo">
                    <img src="logo/maha_aastha_logo.png" alt="Maha-AASTHA Logo" style="height: 36px; width: auto;">
                    <span>Maha-AASTHA</span>
                </div>
                <button class="mobile-menu-close" onclick="toggleMobileMenu()" aria-label="Close menu">×</button>
            </div>
            <nav class="mobile-menu-nav">
                <a href="#services" onclick="closeMobileMenu()">Services</a>
                <a href="#features" onclick="closeMobileMenu()">Features</a>
                <a href="#news" onclick="closeMobileMenu()">News</a>
                <a href="#grievance" onclick="closeMobileMenu()">Grievance</a>
                <a href="grievance.html" onclick="navigateToStatus(event)">Grievance Status</a>
                <a href="#contact" onclick="closeMobileMenu()">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>One secure place for Mumbai Government office records</h1>
            <p>Securely store, access, and manage office data, approvals, and services—all in one place.</p>
            <div class="hero-actions">
                <a href="#grievance" class="btn btn-primary">Create Grievance</a>
                <a href="grievance.html" class="btn btn-secondary">Grievance Status</a>
            </div>
        </div>
    </section>

    <main role="main">
        <!-- About -->
        <section class="section">
            <div class="container">
                <div class="about-card">
                    <div class="about-content">
                        <div class="about-text">
                            <h2 class="section-title">About Maha-AASTHA Portal</h2>
                            <p class="about-description">
                                The Maha-AASTHA Portal is Maharashtra Government's unified platform for managing employee records, 
                                leave applications, approvals, and grievances. Designed for employees, DDOs, and nodal officers, 
                                it streamlines administrative processes while ensuring transparency and accountability.
                            </p>
                            <div class="about-features">
                                <div class="feature-item">
                                    <div class="feature-icon">🔒</div>
                                    <div class="feature-text">
                                        <h4>Secure & Reliable</h4>
                                        <p>Bank-grade security with encrypted data transmission</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">⚡</div>
                                    <div class="feature-text">
                                        <h4>Fast Processing</h4>
                                        <p>Streamlined workflows for quick approvals</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">📱</div>
                                    <div class="feature-text">
                                        <h4>Mobile Ready</h4>
                                        <p>Access from anywhere, anytime on any device</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="about-visual">
                            <div class="visual-card">
                                <div class="visual-icon">🏛️</div>
                                <h3>Government of Maharashtra</h3>
                                <p>Digital Transformation Initiative</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Statistics -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">Portal Statistics</h2>
                <div class="stats">
                    <div class="card stat-card">
                        <div class="stat-number" data-target="45">0</div>
                        <div class="stat-label">Departments Onboarded</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-number" data-target="2500000">0</div>
                        <div class="stat-label">Records Managed</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-number" data-target="3">0</div>
                        <div class="stat-label">Avg. Approval Time (Days)</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-number" data-target="150000">0</div>
                        <div class="stat-label">Active Employees</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Grievance Form -->
        <section class="section" id="grievance">
            <div class="container">
                <h2 class="section-title">Create Grievance</h2>
                <form class="grievance-form" id="grievanceForm">
                    <!-- Progress Indicator -->
                    <div class="form-progress">
                        <div class="progress-step active" data-step="A">
                            <div class="progress-circle">A</div>
                            <span>User Info</span>
                        </div>
                        <div class="progress-step" data-step="B">
                            <div class="progress-circle">B</div>
                            <span>Role</span>
                        </div>
                        <div class="progress-step" data-step="C">
                            <div class="progress-circle">C</div>
                            <span>Details</span>
                        </div>
                        <div class="progress-step" data-step="D">
                            <div class="progress-circle">D</div>
                            <span>Documents</span>
                        </div>
                        <div class="progress-step" data-step="E">
                            <div class="progress-circle">E</div>
                            <span>Confirm</span>
                        </div>
                        <div class="progress-step" data-step="F">
                            <div class="progress-circle">F</div>
                            <span>Submit</span>
                        </div>
                    </div>

                    <!-- Section A: User Information -->
                    <div class="form-section" id="sectionA">
                        <h3>A. User Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="employeeId">Employee ID <span class="required">*</span></label>
                                <input type="text" id="employeeId" name="employeeId" placeholder="Enter your Employee ID" required aria-describedby="employeeIdError">
                                <div class="error-message" id="employeeIdError"></div>
                            </div>
                            <div class="form-group">
                                <label for="employeeName">Name of Employee <span class="required">*</span></label>
                                <input type="text" id="employeeName" name="employeeName" placeholder="Enter your full name" required aria-describedby="employeeNameError">
                                <div class="error-message" id="employeeNameError"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="designation">Designation <span class="required">*</span></label>
                                <input type="text" id="designation" name="designation" placeholder="Enter your designation" required aria-describedby="designationError">
                                <div class="error-message" id="designationError"></div>
                            </div>
                            <div class="form-group">
                                <label for="department">Department <span class="required">*</span></label>
                                <input type="text" id="department" name="department" placeholder="Enter your department" required aria-describedby="departmentError">
                                <div class="error-message" id="departmentError"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="officeName">Office Name <span class="required">*</span></label>
                                <input type="text" id="officeName" name="officeName" placeholder="Enter your office name" required aria-describedby="officeNameError">
                                <div class="error-message" id="officeNameError"></div>
                            </div>
                            <div class="form-group">
                                <label for="districtName">District Name <span class="required">*</span></label>
                                <input type="text" id="districtName" name="districtName" placeholder="Enter your district name" required aria-describedby="districtNameError">
                                <div class="error-message" id="districtNameError"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mobileNumber">Mobile Number <span class="required">*</span></label>
                                <input type="tel" id="mobileNumber" name="mobileNumber" placeholder="Enter your 10-digit mobile number" required pattern="[0-9]{10,13}" aria-describedby="mobileNumberError mobileNumberHint">
                                <div id="mobileNumberHint" style="font-size: 12px; color: var(--muted);">Enter 10-13 digit mobile number</div>
                                <div class="error-message" id="mobileNumberError"></div>
                            </div>
                            <div class="form-group">
                                <label for="officialEmail">Official Email ID <span class="required">*</span></label>
                                <input type="email" id="officialEmail" name="officialEmail" placeholder="Enter your official email address" required aria-describedby="officialEmailError officialEmailHint">
                                <div id="officialEmailHint" style="font-size: 12px; color: var(--muted);">example@dept.gov.in</div>
                                <div class="error-message" id="officialEmailError"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Section B: Role Selection -->
                    <div class="form-section" id="sectionB">
                        <h3>B. Role Selection</h3>
                        <div class="">
                            <div class="form-group">
                                <label for="userRole">Select Your Role <span class="required">*</span></label>
                                <select id="userRole" name="userRole" required aria-describedby="userRoleError">
                                    <option value="">-- Select Role --</option>
                                    <option value="HDS Executive">HDS Executive</option>
                                    <option value="Data Entry Operation">Data Entry Operation</option>
                                    <option value="Drawing & Disbursing Officer">Drawing & Disbursing Officer</option>
                                    <option value="Departmental Maha-AASTHA Desk Nodal Officer">Departmental Maha-AASTHA Desk Nodal Officer</option>
                                    <option value="Employee">Employee</option>
                                </select>
                                <div class="error-message" id="userRoleError"></div>
                            </div>
                            <div class="form-group">
                                <label>Computed Priority</label>
                                <div id="priorityDisplay" class="priority-chip priority-low">Low</div>
                            </div>
                        </div>
                    </div>

                    <!-- Section C: Complaint Details -->
                    <div class="form-section" id="sectionC">
                        <h3>C. Complaint Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="issueTimestamp">Date & Time Stamp of Issue Logged</label>
                                <input type="datetime-local" id="issueTimestamp" name="issueTimestamp">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="issueCategory">Issue Category <span class="required">*</span></label>
                                <select id="issueCategory" name="issueCategory" required aria-describedby="issueCategoryError">
                                    <option value="">-- Select Category --</option>
                                </select>
                                <div class="error-message" id="issueCategoryError"></div>
                            </div>
                            <div class="form-group">
                                <label for="issueSubCategory">Issue Sub-Category <span class="required">*</span></label>
                                <select id="issueSubCategory" name="issueSubCategory" required aria-describedby="issueSubCategoryError">
                                    <option value="">-- Select Sub-Category --</option>
                                </select>
                                <div class="error-message" id="issueSubCategoryError"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="issueRelated">Select Issue Related To <span class="required">*</span></label>
                                <select id="issueRelated" name="issueRelated" required aria-describedby="issueRelatedError">
                                    <option value="">-- Select Issue Related To --</option>
                                </select>
                                <div class="error-message" id="issueRelatedError"></div>
                            </div>
                            <div class="form-group">
                                <label for="issueSection">Select Section (Module / E-Order / etc.)</label>
                                <select id="issueSection" name="issueSection" aria-describedby="issueSectionError">
                                    <option value="">-- Select Section --</option>
                                </select>
                                <div class="error-message" id="issueSectionError"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="issueSubSection">Select Sub-Section (Sections of Service Book)</label>
                                <select id="issueSubSection" name="issueSubSection" aria-describedby="issueSubSectionError">
                                    <option value="">-- Select Sub-Section --</option>
                                </select>
                                <div class="error-message" id="issueSubSectionError"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="issueSubject">Subject (Complaint Title) <span class="required">*</span></label>
                            <input type="text" id="issueSubject" name="issueSubject" placeholder="Enter a brief subject for your grievance" required maxlength="120" aria-describedby="issueSubjectError issueSubjectCounter">
                            <div id="issueSubjectCounter" style="font-size: 12px; color: var(--muted); text-align: right;">0/120</div>
                            <div class="error-message" id="issueSubjectError"></div>
                        </div>
                        <div class="form-group">
                            <label for="issueDescription">Detailed Description of Issue <span class="required">*</span></label>
                            <textarea id="issueDescription" name="issueDescription" placeholder="Please provide a detailed description of your issue. Include relevant dates, people involved, and any other important details." required rows="5" minlength="30" aria-describedby="issueDescriptionError issueDescriptionHint"></textarea>
                            <div id="issueDescriptionHint" style="font-size: 12px; color: var(--muted);">Minimum 30 characters required</div>
                            <div class="error-message" id="issueDescriptionError"></div>
                        </div>
                    </div>

                    <!-- Section D: Supporting Documents -->
                    <div class="form-section" id="sectionD">
                        <h3>D. Supporting Documents</h3>
                        <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                            <p>Click to upload files or drag and drop</p>
                            <p style="font-size: 12px; color: var(--muted);">Maximum 5 files, 10MB each</p>
                            <input type="file" id="fileInput" multiple style="display: none;" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                        </div>
                        <div class="file-list" id="fileList"></div>
                        <div class="error-message" id="fileError"></div>
                    </div>

                    <!-- Section E: Confirmation -->
                    <div class="form-section" id="sectionE">
                        <h3>E. Confirmation</h3>
                        <div class="confirmation-checkbox">
                            <input type="checkbox" id="confirmationCheck" name="confirmationCheck" required aria-describedby="confirmationError">
                            <label for="confirmationCheck">I confirm that the above information is correct to the best of my knowledge. <span class="required">*</span></label>
                        </div>
                        <div class="error-message" id="confirmationError"></div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary submit-btn" disabled>Submit</button>
                </form>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="section">
            <div class="container">
                <div class="card" style="text-align: center; padding: 48px 24px;">
                    <h2>Need help fast?</h2>
                    <p style="font-size: 18px; color: var(--muted); margin: 16px 0 32px;">Submit a grievance now and get your issues resolved quickly.</p>
                    <a href="#grievance" class="btn btn-primary">Submit Grievance Now</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <p>&copy; 2024 Government of Maharashtra. All rights reserved. 
        <span style="float: right;">Developed by <a href="https://saarit.in/" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;"><img src="logo/saarlogo.png" alt="Saar Logo" style="height: 24px; width: auto; vertical-align: middle; margin-left: 8px; opacity: 0.9; transition: opacity 0.2s; filter: invert(1);"></a></span></p>
    </footer>

     <!-- Success Modal -->
    <div class="modal" id="successModal" role="dialog" aria-labelledby="modalTitle" aria-describedby="modalDescription">
        <div class="modal-content">
            <h3 id="modalTitle">Grievance Submitted Successfully!</h3>
            <div id="modalDescription">
                <p><strong>Ticket Number:</strong> <span id="ticketNumber"></span></p>
                <p><strong>Submitted On:</strong> <span id="submissionTime"></span></p>
                <p><strong>Priority:</strong> <span id="submissionPriority"></span></p>
                <div id="deviceInfo" style="margin-top: 16px; padding: 16px; background: var(--bg); border-radius: 8px; font-size: 12px;">
                    <strong>Browser/Device Information:</strong><br>
                    <span id="browserInfo"></span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script src="enhance-dropdowns.js"></script>
    <script>
        // Dropdown data structure
        // Dropdown data structure based on documentation
        const DROPDOWNS = {
            category: ["Technical"],
            subCategory: {
                Technical: ["Maha-AASTH Portal"]
            },
            issueRelated: {
                Technical: {
                    "Maha-AASTH Portal": ["Digital Service Book", "E- Orders","Mobile Modules", "Login Issues"]
                }
            },
            section: {
                "Digital Service Book": [
                    "1. EMPLOYEE PERSONAL PROFILE",
                    "2. APPOINTMENT DETAILS AND SUPPORTING DOCUMENTS", 
                    "3. SERVICE HISTORY, GIS, PENSION SCHEME GPF/NPS, DEPARTMENTAL EXAM, TRAINING, WORK STATUS AND REWARDS",
                    "4. PAY, FAMILY, NOMINATION, LEAVE, LTC, HBA, ADVANCES, ASSETS & LIABILITIES DETAILS",
                    "5. SERVICE RECORDS AND VERIFICATION, DEPARTMENTAL ENQUIRY, GOVERNMENT QUARTERS, INTERNAL AUDIT DETAILS",
                    "6. PREVIEW AND UPLOAD SCANNED COPY OF PHYSICAL SERVICE BOOK"
                ],
                "E- Orders": [
                    "1. महाराष्ट्र लोकसेवा आयोगामार्फत शिफारस करण्यात आलेल्या   लिपिक टंकलेखक  यांचे नियुक्ती आदेश.",
                    "2. महाराष्ट्र लोकसेवा आयोगामार्फत शिफारस करण्यात आलेल्या सहायक कक्ष अधिकारी यांचे नियुक्ती आदेश.",
                    "3. महाराष्ट्र लोकसेवा आयोगामार्फत शिफारस करण्यात आलेल्या लघुटंकलेखक/ निम्नश्रेणी लघुलेखक/ उच्चश्रेणी लघुलेखक यांचे नियुक्ती आदेश.",
                    "4. पदस्थापनचे आदेश (महाराष्ट्र लोकसेवा आयोगामार्फत सरळ सेवेने, मर्यादित विभागीय स्पर्धा परीक्षेद्वारे / तदर्थ पदोन्नतीने / आंतरविभागीय बदलीने).",
                    "5. स्वग्राम घोषित करणेबाबत.",
                    "6. वैद्यकीयदृष्ट्या पात्र प्रमाणपत्र.",
                    "7. स्थायित्व प्रमाणपत्र.",
                    "8. आर्थिकदृष्ट्या दुर्बल घटक  प्रमाणपत्र वैधतेची नोंद सेवापुस्तकात घेण्याबाबतचे आदेश.",
                    "9. उन्नत आणि प्रगत व्यक्ती गटामध्ये मोडत नसल्याबाबतचे प्रमाणपत्र वैधतेची नोंद सेवापुस्तकात घेण्याबाबतचे आदेश.",
                    "10. जात प्रमाणपत्राची वैधता व सत्यता तपासणीसाठी पाठवावयाची  पत्रे (2 पत्रे).",
                    "11. उन्नत व प्रगत गटात मोडत नसल्याचे प्रमाणपत्र  (नॉन क्रिमीलेअर सर्टिफिेकेट) पडताळणीसाठी पत्र.",
                    "12. जात वैधता प्रमाणपत्र पडताळणीची नोंद घेण्याबाबतचे आदेश.",
                    "13. पूर्वचारित्र्य पडताळणीची नोंद घेण्याबाबतचे आदेश.",
                    "14. पूर्वचारित्र्य पडताळणीची तपासणीसाठी पाठवावयाचे पत्र",
                    "15. महाराष्ट्र लोकसेवा आयोगामार्फत शिफारस करण्यात आलेल्या लिपिक-टंकलेखक/सहायक कक्ष अधिकारी/लघुलेखक/ निम्नश्रेणी लघुलेखक/ उच्चश्रेणी लघुलेखक यांची महाराष्ट्र नागरी सेवा (सुधारित वेतन) नियम, 2019 नुसार  प्रारंभिक वेतननिश्चितीचे आदेश.",
                    "16. पदोन्नतीनंतरची वेतननिश्चिती",
                    "17. लिपिक-टंकलेखक ते सह सचिव संवर्गातील अधिकारी/कर्मचाऱ्यांच्या ज्येष्ठतेच्या दिनांकानुसार वेतननिश्चितीचे आदेश.",
                    "18. सुधारित सेवांतर्गत आश्वासित प्रगती योजनेंतर्गत वेतननिश्चितीचे.",
                    "19. अकार्यात्मक वेतनसंरचनेत / वेतनश्रेणीत वेतननिश्चिती करण्याबाबतचे  ज्ञापन.",
                    "20. वेतन पडताळणी पथकाच्या आक्षेपानुसार  वेतननिश्चितीचे आदेश.",
                    "21. वेतनवाढ रोखून  ठेवण्याबाबतचे आदेश.",
                    "22. रोखून ठेवण्यात आलेली वेतनवाढ मुक्त करण्याबाबतचे आदेश.",
                    "23. दिनांक १ जुलै रोजीची काल्पनिक वेतनवाढ मंजूरीचे आदेश.",
                    "24. रजा मंजूरीचे आदेश (अर्जित रजा / परिवर्तीत रजा/अर्धवेतनी रजा/असाधारण रजा).",
                    "25. स्वग्राम/ महाराष्ट्र दर्शन रजा आदेश.",
                    "26. परदेश (पर्यटन) रजा मंजूरी आदेश.",
                    "27. श्वान दंश रजा मंजूरीचे आदेश.",
                    "28. असाधारण रजा मंजूरीचे आदेश.",
                    "29. गर्भपात रजा मंजूरी आदेश.",
                    "30. प्रसूती रजा आदेश.",
                    "31. बालसंगोपन रजा आदेश.",
                    "32. विपश्यना रजा मंजूरीचे आदेश.",
                    "33. विशेष रजा (कर्करोग रजा /क्षयरोग /कुष्ठरोग/पक्षघात)   मंजूर करण्याबाबतचे आदेश.",
                    "34. स्वग्राम/महाराष्ट्र दर्शन रजा प्रास सवलत",
                    "35. मराठी व हिंदी भाषा परीक्षा उत्तीर्ण होण्यापासून सूट देण्याबाबतचे आदेश.",
                    "36. एतदर्थ मंडळामार्फत घेण्यात आलेल्या मराठी भाषा उच्चश्रेणी परीक्षेच्या निकालाची नोंद घेण्याबाबत.",
                    "37. एतदर्थ मंडळामार्फत घेण्यात आलेल्या हिंदी भाषा निम्नश्रेणी परीक्षेच्या निकालाची नोंद घेण्याबाबत.",
                    "38. संगणक ज्ञान अर्हता परीक्षा (MS-CIT) उत्तीर्ण केल्याबाबतचे आदेश.",
                    "39. संगणक अर्हता परीक्षा उत्तीर्ण होण्यापासून सूट देण्याबाबतचे आदेश.",
                    "40. लिपिक-टंकलेखक/सहायक कक्ष अधिकारी यांच्या सेवा प्रवेशोत्तर परीक्षेच्या निकालाची सेवापुस्तकात नोंद घेण्याबाबतचे आदेश.",
                    "41. सहायक कक्ष अधिकाऱ्यांच्या कक्ष अधिकारी पदावरील पदोन्नती परीक्षेच्या निकालाची नोंद सेवापुस्तकात घेण्याबाबतचे आदेश.",
                    "42. वैयक्तिक संगणक खरेदी अग्रिम मंजूरीचे आदेश.",
                    "43. स्कूटर खरेदी अग्रिम मंजूरीचे आदेश.",
                    "44. घरबांधणी अग्रिम (तयार घर/ बँक परतफेड) मंजूर करण्याबाबतचे आदेश.",
                    "45. घरबांधणी अग्रिम  (बांधकाम सुरु असलेल्या सदनिकेकरिता) पहिल्या हप्त्यात मंजूर करण्याबाबतचे आदेश.",
                    "46. घरबांधणी अग्रिम (बांधकाम सुरु असलेल्या सदनिकेकरिता) दुसऱ्या हप्त्यात मंजूर करण्याबाबतचे आदेश.",
                    "47. नवीन/जूनी मोटरकार  खरेदीसाठी अग्रिम मंजूर करण्याबाबतचे आदेश.",
                    "48. भविष्य निर्वाह निधी खात्यातील 90% ना परतावा अग्रिम काढण्यास मंजूरी देण्याबाबतचे आदेश",
                    "49. भविष्य निर्वाह निधी खात्यातील परतावा अग्रिम काढण्यास मंजूरी देण्याबाबतचे आदेश",
                    "50. भविष्य निर्वाह निधी खात्यातील ना परतावा रक्कम  काढण्यास मंजूरी देण्याबाबतचे आदेश.",
                    "51. भविष्य निर्वाह निधीमधून घराच्या दुरुस्तीकरिता अग्रीम मंजूरीचे आदेश.",
                    "52. अकार्यात्मक वेतनश्रेणी मंजूर करण्याबाबतचे  कार्यालयीन आदेश.",
                    "53. सुधारित आश्वासित प्रगती योजनेंतर्गत लाभ मंजूरीचे आदेश.",
                    "54. अवर सचिव/ उप सचिव/सह सचिव संवर्गातील अधिकाऱ्यांना निवडश्रेणी मंजूर करण्याबाबतचे आदेश.",
                    "55. सेवा जोडून देण्याबाबतचे आदेश.",
                    "56. राज्य  प्रशिक्षण धोरणांतर्गत लिपिक-टंकलेखक/सहायक कक्ष अधिकारी/कक्ष अधिकारी वर्गाकरिता आयोजित पायाभूत प्रशिक्षण पूर्ण केल्याची नोंद घेण्याबाबतचे आदेश.",
                    "57. पदोन्नतीनंतरचे प्रशिक्षण कार्यमुक्ती आदेश.",
                    "58. विभागात रुजू करुन घेण्याबाबतचे आदेश.",
                    "59. वैद्यकीय खर्च प्रतिपूर्तीकरिता विकल्प देण्याबाबत.",
                    "60. अतिरिक्त कार्यभार देण्याबाबतचे आदेश.",
                    "61. अतिरिक्त कार्यभार सांभाळल्याबद्दल विशेष वेतन मंजूरीचे आदेश.",
                    "62. प्रतिक्षाधीन कालावधी नियमित करण्याबाबतचे आदेश.",
                    "63. वयाच्या 49 व्या वर्षानंतर करावयाच्या सेवा पुनर्विलोकनाबाबतचे आदेश (राजपत्रित अधिकारी).",
                    "64. वयाच्या  54 व्या वर्षानंतर  करावयाच्या सेवा पुनर्विलोकनाबाबतचे आदेश (गट-ब अराजपत्रित व गट क कर्मचारी).",
                    "65. कार्यमुक्ततेचे आदेश (पदोन्नतीने /आंतरविभागीय बदलीने/ प्रतिनियुक्तीने/निवडणूक कामाकरिता).",
                    "66. ना देय/ना चौकशी प्रमाणपत्र.",
                    "67. अनधिकृत कार्यालयीन गैरहजेरीबाबतचे ज्ञापन.",
                    "68. अनधिकृत रजेबाबत विभागीय चौकशीबाबतचे आदेश.",
                    "69. निलंबन आदेश.",
                    "70. निर्वाहभत्ता मंजूर करण्याबाबतचे आदेश.",
                    "71. खालील पदावर पदावनत झाल्यानंतरची वेतननिश्चिती",
                    "72. शासन सेवेत पुन:स्थापित करणेबाबत.",
                    "73. कुटुंब निवृत्तिवेतन मंजूर करण्याबाबतचे आदेश.",
                    "74. सेवानिवृत्ती आदेश.(अराजपत्रित)",
                    "75. सेवानिवृत्ती अधिसूचना.(राजपत्रित अधिकारी)",
                    "76. स्वेच्छा सेवानिवृत्ती आदेश.",
                    "77. सेवा समाप्ती आदेश.",
                    "78. तात्पुरते सेवानिवृत्ति वेतन मंजूर करण्याबाबतचे आदेश.",
                    "79. सेवानिवृत्तिनंतर गट विमा योजना व बचत निधी रक्कम मंजूर करण्याबाबतचे आदेश.",
                    "80. सेवानिवृत्तिनंतर अर्जित रजेच्या रोखीकरणाचे आदेश.",
                    "81. निवृत्तिवेतन प्राधिकृत करण्याकरिता महालेखापालांना प्रस्ताव पाठविणे.",
                    "82. निवृत्तिवेतन प्राधिकृत करण्याकरिता कोषागार कार्यालयास पाठवावयाचे पत्र",
                    "83. राजीनामा दिल्याने सेवासमाप्ती आदेश",
                    "84. नवीन पदावर रुजु होण्याकरिता कार्यमुक्त करुन सेवासमाप्ती करणे"
                ],
                "Login Issues": ["Admin Login", "User Login", "Data Entry Operator Login "],
                "Mobile Modules": ["Service Book", "Attendance", "Finance", "E-Orders","I-GOT","Videos","Leave","E-Office","NITI for states", "Goi Intranet", "Quick Links","Websites"]
            },
            subSection: {
                "1. EMPLOYEE PERSONAL PROFILE": [
                    "1.1 Personal Information/ Identity Details",
                    "1.2 Personal Details and Medical Fitness Information",
                    "1.3 Residential Details, Office and Emergency Contact details",
                    "1.4 Photograph and Signature",
                    "1.5 Educational Qualification Details (At the Time of Joining / Subsequently Acquired)",
                    "1.6 Disability Information"
                ],
                "2. APPOINTMENT DETAILS AND SUPPORTING DOCUMENTS": [
                    "2.1 Appointment Details"
                ],
                "3. SERVICE HISTORY, GIS, PENSION SCHEME GPF/NPS, DEPARTMENTAL EXAM, TRAINING, WORK STATUS AND REWARDS": [
                    "3.1 Posting/ Promotion/ Transfer details",
                    "3.2 Central Government Employees Group Insurance Scheme/ Group Insurance Scheme/ Accidental Insurance Scheme",
                    "3.3 Pension Scheme, General Provident Fund (GPF), NPS (National Pension Scheme), DCPS",
                    "3.4 Departmental Examination",
                    "3.5 Training and Capacity Building",
                    "3.6 Employee Work Status- Probation / Permanency / 49-54 Review",
                    "3.7 Rewards / Achievements / Certificates"
                ],
                "4. PAY, FAMILY, NOMINATION, LEAVE, LTC, HBA, ADVANCES, ASSETS & LIABILITIES DETAILS": [
                    "4.1 Pay Fixation, Increment, Assured Career Progressive Scheme/ Modified Assured Career Progressive Scheme, Non-functional Scale, Time Scale Promotion, Salary Allowance",
                    "4.2 Family Members",
                    "4.3 Nominations",
                    "4.4 Leaves- HPL/ CL/ EL Credit",
                    "4.5 Leave Travel Concession (LTC)",
                    "4.6 House Building Advance (HBA)",
                    "4.7 Other Advances",
                    "4.8 Assets And Liabilities"
                ],
                "5. SERVICE RECORDS AND VERIFICATION, DEPARTMENTAL ENQUIRY, GOVERNMENT QUARTERS, INTERNAL AUDIT DETAILS": [
                    "5.1 Previous Govt. Service records",
                    "5.2 Foreign Service",
                    "5.3 Record of Break in Service",
                    "5.4 Departmental Enquiry",
                    "5.5 Government Quarters",
                    "5.6 Internal Audit"
                ],
                "6. PREVIEW AND UPLOAD SCANNED COPY OF PHYSICAL SERVICE BOOK": [
                    "6.1 Approve Service Book Complete Details",
                    "6.2 Upload Service Book"
                ]
            }
        };

        // Role priority mapping
        const ROLE_PRIORITY = {
            "HDS Executive": "Mid",
            "Data Entry Operation": "Mid", 
            "Drawing & Disbursing Officer": "High",
            "Departmental Maha-AASTHA Desk Nodal Officer": "High",
            "Employee": "Low"
        };

        // Global variables
        let uploadedFiles = [];
        let formData = {};

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            setupEventListeners();
            animateStats();
            setLastUpdated();
            setCurrentTimestamp();
            
            // Clear any existing form data on page load
            const form = document.getElementById('grievanceForm');
            if (form) {
                form.reset();
                uploadedFiles = [];
                updateFileList();
            }
        });

        function initializeForm() {
            // Populate category dropdown
            const categorySelect = document.getElementById('issueCategory');
            DROPDOWNS.category.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        function setupEventListeners() {
            // Form validation
            const form = document.getElementById('grievanceForm');
            const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
            const confirmationCheck = document.getElementById('confirmationCheck');
            const submitBtn = form.querySelector('.submit-btn');

            // Real-time validation
            inputs.forEach(input => {
                input.addEventListener('input', validateField);
                input.addEventListener('blur', validateField);
            });

            confirmationCheck.addEventListener('change', updateSubmitButton);

            // Role selection
            document.getElementById('userRole').addEventListener('change', updatePriority);

            // Dynamic dropdowns
            document.getElementById('issueCategory').addEventListener('change', updateSubCategory);
            document.getElementById('issueSubCategory').addEventListener('change', updateIssueRelated);
            document.getElementById('issueRelated').addEventListener('change', updateSection);
            document.getElementById('issueSection').addEventListener('change', updateSubSection);

            // Subject character counter
            document.getElementById('issueSubject').addEventListener('input', updateSubjectCounter);

            // File upload
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);

            // Form submission
            form.addEventListener('submit', handleFormSubmit);

            // Progress steps
            document.querySelectorAll('.progress-step').forEach(step => {
                step.addEventListener('click', scrollToSection);
            });

            // Smooth scroll for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Prevent beforeunload for navigation links
            document.querySelectorAll('a[href]').forEach(link => {
                link.addEventListener('click', function(e) {
                    // Clear form data before navigation to prevent beforeunload
                    if (this.href.includes('grievance.html')) {
                        const form = document.getElementById('grievanceForm');
                        if (form) {
                            form.reset();
                            uploadedFiles = [];
                            updateFileList();
                        }
                    }
                });
            });

            // Mobile menu toggle
            const mobileToggle = document.querySelector('.mobile-menu-toggle');
            if (mobileToggle) {
                mobileToggle.addEventListener('click', toggleMobileMenu);
            }

            // Prevent accidental form loss (but not for status navigation)
            window.addEventListener('beforeunload', function(e) {
                // Don't show warning if navigating to grievance.html
                if (window.location.href.includes('grievance.html')) {
                    return;
                }
                
                const form = document.getElementById('grievanceForm');
                if (!form) return;
                
                // Check if form has meaningful data (not just default values)
                const formData = new FormData(form);
                let hasData = false;
                
                // Check specific fields that indicate user has started filling the form
                const importantFields = ['employeeId', 'employeeName', 'designation', 'department', 'issueSubject', 'issueDescription'];
                
                for (let field of importantFields) {
                    const value = formData.get(field);
                    if (value && value.trim().length > 0) {
                        hasData = true;
                        break;
                    }
                }
                
                // Also check if files have been uploaded
                if (uploadedFiles && uploadedFiles.length > 0) {
                    hasData = true;
                }
                
                if (hasData) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
        }

        function validateField(e) {
            const field = e.target;
            const fieldGroup = field.closest('.form-group');
            
            // Check if fieldGroup exists
            if (!fieldGroup) {
                // Handle standalone controls (like confirmation checkbox) gracefully
                if (field.id === 'confirmationCheck') {
                    // If there is an aria-describedby pointing to an error node, clear it
                    const describedBy = field.getAttribute('aria-describedby');
                    if (describedBy) {
                        const errorNode = document.getElementById(describedBy);
                        if (errorNode) errorNode.textContent = '';
                    }
                    // Validate checkbox: if required, it must be checked
                    if (field.hasAttribute('required')) {
                        return field.checked;
                    }
                    return true;
                }

                // If no .form-group is present for other controls, skip verbose warning in production
                return true; // Skip validation if no field group found
            }
            
            const errorDiv = fieldGroup.querySelector('.error-message');
            
            let isValid = true;
            let errorMessage = '';

            // Required field validation
            if (field.hasAttribute('required') && !field.value.trim()) {
                isValid = false;
                errorMessage = 'This field is required.';
            }

            // Specific field validations
            switch (field.type) {
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (field.value && !emailRegex.test(field.value)) {
                        isValid = false;
                        errorMessage = 'Please enter a valid email address.';
                    }
                    break;
                case 'tel':
                    const phoneRegex = /^[0-9]{10,13}$/;
                    if (field.value && !phoneRegex.test(field.value.replace(/\s/g, ''))) {
                        isValid = false;
                        errorMessage = 'Please enter a valid 10-13 digit mobile number.';
                    }
                    break;
            }

            // Subject length validation
            if (field.id === 'issueSubject' && field.value.length < 10 && field.value.length > 0) {
                isValid = false;
                errorMessage = 'Subject must be at least 10 characters long.';
            }

            // Description length validation
            if (field.id === 'issueDescription' && field.value.length < 30 && field.value.length > 0) {
                isValid = false;
                errorMessage = 'Description must be at least 30 characters long.';
            }

            // Update UI
            if (isValid) {
                fieldGroup.classList.remove('error');
                errorDiv.textContent = '';
            } else {
                fieldGroup.classList.add('error');
                errorDiv.textContent = errorMessage;
            }

            updateSubmitButton();
            return isValid;
        }

        function validateFieldDirect(field) {
            const fieldGroup = field.closest('.form-group');
            
            // Check if fieldGroup exists
            if (!fieldGroup) {
                // Handle standalone confirmation checkbox specially
                if (field.id === 'confirmationCheck') {
                    const describedBy = field.getAttribute('aria-describedby');
                    if (describedBy) {
                        const errorNode = document.getElementById(describedBy);
                        if (errorNode) errorNode.textContent = '';
                    }
                    if (field.hasAttribute('required')) {
                        return field.checked;
                    }
                    return true;
                }

                return true; // No group - nothing to update
            }
            
            const errorDiv = fieldGroup.querySelector('.error-message');
            
            let isValid = true;
            let errorMessage = '';

            // Required field validation
            if (field.hasAttribute('required') && !field.value.trim()) {
                isValid = false;
                errorMessage = 'This field is required.';
            }

            // Specific field validations
            if (field.id === 'mobileNumber' && field.value) {
                const phoneRegex = /^[0-9]{10,13}$/;
                if (!phoneRegex.test(field.value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid 10-13 digit mobile number.';
                }
            }

            if (field.id === 'officialEmail' && field.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(field.value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid email address.';
                }
            }

            if (field.id === 'issueSubject' && field.value) {
                if (field.value.length < 10 || field.value.length > 120) {
                    isValid = false;
                    errorMessage = 'Subject must be between 10 and 120 characters.';
                }
            }

            // Description length validation
            if (field.id === 'issueDescription' && field.value.length < 30 && field.value.length > 0) {
                isValid = false;
                errorMessage = 'Description must be at least 30 characters long.';
            }

            // Update UI
            if (isValid) {
                fieldGroup.classList.remove('error');
                if (errorDiv) errorDiv.textContent = '';
            } else {
                fieldGroup.classList.add('error');
                if (errorDiv) errorDiv.textContent = errorMessage;
            }

            return isValid;
        }

        function updateSubmitButton() {
            const form = document.getElementById('grievanceForm');
            const submitBtn = form.querySelector('.submit-btn');
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            const confirmationCheck = document.getElementById('confirmationCheck');
            
            let allValid = true;

            // Check all required fields
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    allValid = false;
                }
            });

            // Check file upload limit
            if (uploadedFiles.length > 5) {
                allValid = false;
            }

            // Check confirmation
            if (!confirmationCheck.checked) {
                allValid = false;
            }

            submitBtn.disabled = !allValid;
        }

        function updatePriority() {
            const role = document.getElementById('userRole').value;
            const priorityDisplay = document.getElementById('priorityDisplay');
            
            if (role && ROLE_PRIORITY[role]) {
                const priority = ROLE_PRIORITY[role];
                priorityDisplay.textContent = priority;
                priorityDisplay.className = `priority-chip priority-${priority.toLowerCase()}`;
            } else {
                priorityDisplay.textContent = 'Low';
                priorityDisplay.className = 'priority-chip priority-low';
            }
        }

        function updateSubCategory() {
            const category = document.getElementById('issueCategory').value;
            const subCategorySelect = document.getElementById('issueSubCategory');
            
            // Clear dependent dropdowns
            clearSelect(subCategorySelect);
            clearSelect(document.getElementById('issueRelated'));
            clearSelect(document.getElementById('issueSection'));
            clearSelect(document.getElementById('issueSubSection'));
            
            if (category && DROPDOWNS.subCategory[category]) {
                DROPDOWNS.subCategory[category].forEach(subCategory => {
                    const option = document.createElement('option');
                    option.value = subCategory;
                    option.textContent = subCategory;
                    subCategorySelect.appendChild(option);
                });
            }
        }

        function updateIssueRelated() {
            const category = document.getElementById('issueCategory').value;
            const subCategory = document.getElementById('issueSubCategory').value;
            const issueRelatedSelect = document.getElementById('issueRelated');
            
            // Clear dependent dropdowns
            clearSelect(issueRelatedSelect);
            clearSelect(document.getElementById('issueSection'));
            clearSelect(document.getElementById('issueSubSection'));
            
            if (category && subCategory && DROPDOWNS.issueRelated[category] && DROPDOWNS.issueRelated[category][subCategory]) {
                DROPDOWNS.issueRelated[category][subCategory].forEach(issue => {
                    const option = document.createElement('option');
                    option.value = issue;
                    option.textContent = issue;
                    issueRelatedSelect.appendChild(option);
                });
            }
        }

        function updateSection() {
            const issueRelated = document.getElementById('issueRelated').value;
            const sectionSelect = document.getElementById('issueSection');
            
            // Clear dependent dropdowns
            clearSelect(sectionSelect);
            clearSelect(document.getElementById('issueSubSection'));
            
            if (issueRelated && DROPDOWNS.section[issueRelated]) {
                DROPDOWNS.section[issueRelated].forEach(section => {
                    const option = document.createElement('option');
                    option.value = section;
                    option.textContent = section;
                    sectionSelect.appendChild(option);
                });
            }
        }

        function updateSubSection() {
            const section = document.getElementById('issueSection').value;
            const subSectionSelect = document.getElementById('issueSubSection');
            
            clearSelect(subSectionSelect);
            
            if (section && DROPDOWNS.subSection[section]) {
                DROPDOWNS.subSection[section].forEach(subSection => {
                    const option = document.createElement('option');
                    option.value = subSection;
                    option.textContent = subSection;
                    subSectionSelect.appendChild(option);
                });
            }
        }

        function clearSelect(selectElement) {
            while (selectElement.children.length > 1) {
                selectElement.removeChild(selectElement.lastChild);
            }
        }

        function updateSubjectCounter() {
            const subject = document.getElementById('issueSubject');
            const counter = document.getElementById('issueSubjectCounter');
            counter.textContent = `${subject.value.length}/120`;
        }

        function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            const fileError = document.getElementById('fileError');
            
            // Validate file count
            if (uploadedFiles.length + files.length > 5) {
                fileError.textContent = 'Maximum 5 files allowed.';
                return;
            }
            
            // Validate file size and type
            for (let file of files) {
                if (file.size > 10 * 1024 * 1024) { // 10MB
                    fileError.textContent = `File "${file.name}" is too large. Maximum size is 10MB.`;
                    return;
                }
                
                const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/jpg', 'image/png'];
                if (!allowedTypes.includes(file.type)) {
                    fileError.textContent = `File "${file.name}" is not supported. Please upload PDF, DOC, DOCX, JPG, JPEG, or PNG files.`;
                    return;
                }
            }
            
            // Add files
            uploadedFiles.push(...files);
            fileError.textContent = '';
            updateFileList();
            updateSubmitButton();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name} (${formatFileSize(file.size)})</span>
                    <button type="button" class="file-remove" onclick="removeFile(${index})">Remove</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            updateSubmitButton();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function populateFromMahaAastha() {
            // Mock auto-fill function - in production this would call an API
            document.getElementById('employeeId').value = 'EMP001234';
            document.getElementById('employeeName').value = 'Rajesh Kumar Sharma';
            document.getElementById('designation').value = 'Assistant Commissioner';
            document.getElementById('department').value = 'Revenue Department';
            document.getElementById('officeName').value = 'Collectorate Mumbai';
            document.getElementById('districtName').value = 'Mumbai';
            document.getElementById('mobileNumber').value = '9876543210';
            document.getElementById('officialEmail').value = 'rajesh.sharma@revenue.gov.in';
            
            // Trigger validation
            const fields = ['employeeId', 'employeeName', 'designation', 'department', 'officeName', 'districtName', 'mobileNumber', 'officialEmail'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                field.dispatchEvent(new Event('input'));
            });
        }

        function scrollToSection(e) {
            const step = e.currentTarget.dataset.step;
            const section = document.getElementById(`section${step}`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // Final validation
            const form = e.target;
            const formData = new FormData(form);
            let isValid = true;
            
            // Validate all required fields
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            requiredFields.forEach(field => {
                if (!validateFieldDirect(field)) {
                    isValid = false;
                }
            });
            
            if (!isValid) {
                alert('Please correct the errors in the form before submitting.');
                return;
            }
            
            // Show loading state
            const submitBtn = form.querySelector('.submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;
            
            try {
                // Ensure timestamp is set before collecting data
                ensureTimestampSet();
                
                // Collect form data
                const issueTimestampValue = formData.get('issueTimestamp');
                const grievanceData = {
                    employeeId: formData.get('employeeId'),
                    employeeName: formData.get('employeeName'),
                    mobileNumber: formData.get('mobileNumber'),
                    designation: formData.get('designation'),
                    department: formData.get('department'),
                    officeName: formData.get('officeName'),
                    districtName: formData.get('districtName'),
                    officialEmail: formData.get('officialEmail'),
                    userRole: formData.get('userRole'),
                    priority: ROLE_PRIORITY[formData.get('userRole')] || 'Low',
                    issueTimestamp: issueTimestampValue && issueTimestampValue.trim() !== '' ? issueTimestampValue : new Date().toISOString(),
                    issueCategory: formData.get('issueCategory'),
                    issueSubCategory: formData.get('issueSubCategory'),
                    issueRelated: formData.get('issueRelated'),
                    issueSection: formData.get('issueSection'),
                    issueSubSection: formData.get('issueSubSection'),
                    subject: formData.get('issueSubject'),
                    description: formData.get('issueDescription'),
                    filesCount: uploadedFiles.length
                };
                
                // Submit to API
                // If the page is opened via file:// (local file), fetching /api/grievances will fail
                // due to CORS and unsupported protocol. In that case use the local submitToApi mock.
                let result;
                // if (location.protocol === 'file:') {
                //     console.warn('Running from file:// - using local mock submitToApi instead of network fetch.');
                //     result = await submitToApi(grievanceData);
                // } else {
                    const response = await fetch('/api/grievances', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(grievanceData)
                    });
                    result = await response.json();
                // }

                if (result && result.success) {
                    // Show success modal
                    // support both result.data (API) and result.data-like object returned from mock
                    const data = result.data || result;
                    showSuccessModal(data);

                    // Reset form
                    form.reset();
                    uploadedFiles = [];
                    updateFileList();
                    updateSubmitButton();
                } else {
                    throw new Error((result && result.message) || 'Failed to submit grievance');
                }
                
            } catch (error) {
                console.error('Error submitting grievance:', error);
                alert('Failed to submit grievance. Please try again.');
            } finally {
                // Restore button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function showSuccessModal(grievanceData) {
            const modal = document.getElementById('successModal');
            document.getElementById('ticketNumber').textContent = grievanceData.ticket;
            document.getElementById('submissionTime').textContent = new Date(grievanceData.created_at).toLocaleString();
            document.getElementById('submissionPriority').textContent = grievanceData.priority;
            
            // Browser/Device info
            const browserInfo = `
                User Agent: ${navigator.userAgent}<br>
                Platform: ${navigator.platform}<br>
                Viewport: ${window.innerWidth}x${window.innerHeight}<br>
                Language: ${navigator.language}
            `;
            document.getElementById('browserInfo').innerHTML = browserInfo;
            
            modal.classList.add('show');
        }

        function closeModal() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('show');
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('show');
        }

        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.remove('show');
        }

        function navigateToStatus(event) {
            event.preventDefault();
            // Clear any form data that might trigger beforeunload
            const form = document.getElementById('grievanceForm');
            if (form) {
                // Reset form to clear any data
                form.reset();
                // Clear uploaded files
                uploadedFiles = [];
                updateFileList();
            }
            // Navigate without triggering beforeunload
            window.location.href = 'grievance.html';
        }

        function animateStats() {
            const stats = document.querySelectorAll('.stat-number');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const target = parseInt(entry.target.dataset.target);
                        animateCounter(entry.target, target);
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            stats.forEach(stat => observer.observe(stat));
        }

        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 100;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current).toLocaleString();
            }, 20);
        }

        function setLastUpdated() {
            const lastUpdated = document.getElementById('lastUpdated');
            if (lastUpdated) {
                lastUpdated.textContent = new Date().toLocaleDateString();
            }
        }

        function setCurrentTimestamp() {
            const timestampField = document.getElementById('issueTimestamp');
            if (timestampField) {
                const now = new Date();
                const offset = now.getTimezoneOffset() * 60000;
                const localTime = new Date(now.getTime() - offset);
                timestampField.value = localTime.toISOString().slice(0, 16);
            }
        }

        // Ensure timestamp is always set before form submission
        function ensureTimestampSet() {
            const timestampField = document.getElementById('issueTimestamp');
            if (timestampField && (!timestampField.value || timestampField.value.trim() === '')) {
                setCurrentTimestamp();
            }
        }

        // API integration placeholders for future use
        function submitToApi(payload) {
            // Local mock submit used when running the page via file:// or when backend is unavailable.
            console.log('Mock submitToApi called with payload:', payload);

            // Generate a random mock ticket (like TKT-ab12cd34)
            const randomHex = Math.random().toString(16).substring(2, 10).toUpperCase();
            const mockTicket = `TKT-${randomHex}`;

            // Current timestamp
            const now = new Date().toISOString();

            return Promise.resolve({
                success: true,
                data: {
                    ticket: mockTicket,
                    created_at: now,
                    priority: payload.priority || 'Low'
                }
            });
        }
        function getMahaAasthaUser() {
            // This function will fetch user data from Maha-AASTHA API
            console.log('Fetching user data from API');
            return Promise.resolve({
                employeeId: 'EMP001234',
                name: 'Rajesh Kumar Sharma',
                designation: 'Assistant Commissioner',
                department: 'Revenue Department',
                office: 'Collectorate Mumbai',
                district: 'Mumbai',
                mobile: '9876543210',
                email: 'rajesh.sharma@revenue.gov.in'
            });
        }

        // Keyboard navigation support
        document.addEventListener('keydown', function(e) {
            // Esc key closes modal
            if (e.key === 'Escape') {
                const modal = document.getElementById('successModal');
                if (modal.classList.contains('show')) {
                    closeModal();
                }
            }
        });
    </script>

    <!-- ==================== CHATBOT WIDGET ==================== -->
    <!-- ==================== CHATBOT WIDGET ==================== -->
    <div class="chat-widget">
        <div class="chat-bubble" id="chatBubble">
            <img src="logo/main_logo.png" alt="Chat" onerror="this.style.display='none'; this.parentNode.innerHTML='<svg viewBox=\'0 0 24 24\'><path d=\'M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6V9M14,14H6V12H14V14M18,8H6V6H18V8Z\'/></svg>'"/>
            <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
        </div>

        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-avatar">
                        <img src="logo/maha_aastha_logo.png" alt="Maha Aastha Logo" onerror="this.style.display='none'">
                    </div>
                    <div class="chat-header-text">
                        <h3 id="chatTitle">Maha Aastha Grievance Redressal System</h3>
                        <p id="connectionStatus">Ready to help</p>
                    </div>
                </div>
                
                <div class="language-selector">
                   <select class="language-dropdown" id="languageSelect">
                        <option value="mr">मराठी</option>
                        <option value="en">English</option>
                    </select>
                </div>
                
                <button class="close-chat" id="closeChat">&times;</button>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="chat-input-form">
                    <input type="text" 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Ask your query here">
                    <button class="send-btn" id="sendBtn" disabled>
                        <svg viewBox="0 0 24 24">
                            <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="quick-actions">
                    <button class="quick-action-btn" id="restartBtn">Restart</button>
                    <button class="quick-action-btn" id="clearChatBtn">Clear Chat</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== CHATBOT SCRIPT ==================== -->
    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:8000';
        
        // MAHA AASTHA SCRIPTS
        const MAHA_AASTHA_SCRIPTS = {
            en: {
                pageTitle: "Welcome to Maha Aastha Chatbot.",
                chatTitle: "Maha Aastha Grievance Redressal System",
                connectionStatus: "Ready to help",
                restartBtn: "Restart",
                clearChatBtn: "Clear Chat",
                input_placeholder: "Ask your query here",
                suggestions_title: "Questions you can ask me:",
                greeting_response: "Hello! Welcome to the Maha Aastha Grievance Redressal System. How may I help you today?",
                how_may_help: "How may I help you today?",
                unknown_question: "I can help you with ticket registration, status checking, or providing feedback. Please choose from the suggestions above or be more specific.",
                welcome: "Welcome to Maha Aastha Grievance Redressal System AI-ChatBot.",
                question1: "Would you like to register a Ticket on the Maha Aastha Grievance Redressal System?",
                question2: "Would you like to check the status of the ticket which you have registered on the Maha Aastha Grievance Redressal System?",
                question3: "Would you like to provide feedback regarding the resolution of your ticket addressed through the Maha Aastha Grievance Redressal System?",
                register_intro: "You can register your Ticket on the Maha Aastha Grievance Redressal System through below link:",
                register_link: "http://172.17.46.11:8001/#grievance",
                ticket_id_prompt: "Please enter your Ticket ID or Mobile Number to check the status:",
                ticket_id_input_label: "Enter Ticket ID (Example: TKT-12345678) or Mobile Number (Example: 9876543210)",
                ticket_id_placeholder: "Type your Ticket ID or Mobile Number here...",
                invalid_ticket_id: "Please provide a valid Ticket ID (e.g., TKT-12345678) or 10-digit mobile number (e.g., 9876543210).",
                check_status_btn: "Check Ticket Status",
                processing: "Processing...",
                status_prefix: "The current status of your Ticket is as follows:",
                rating_request: "Please provide your rating between 1 and 5:",
                rating_title: "Rate our service quality",
                submit_rating: "Submit Rating",
                submitting: "Submitting...",
                invalid_input: "The information you have entered is invalid. Please try again.",
                thank_you: "Thank you for using the Maha Aastha Grievance Redressal System.",
                yes: "YES",
                no: "NO",
                register_button: "Register Ticket",
                suggestions_title: "Quick Suggestions:",
                language_switch_msg: "Language switched to English. Restarting conversation...",
                status_details_header: "Ticket Status Details",
                track_ticket_help: "You can also track your ticket status at: http://172.17.46.11:8001/#view-ticket",
                rating_labels: {
                    1: "Poor",
                    2: "Fair", 
                    3: "Good",
                    4: "Very Good",
                    5: "Excellent"
                },
                suggestions: [
                    "I want to check ticket status",
                    "I want to Register a Ticket",
                    "I want to provide feedback"
                ]
            },
            mr: {
                pageTitle: "महा आस्था चॅटबॉटमध्ये आपले स्वागत आहे.",
                chatTitle: "महा आस्था तक्रार निवारण प्रणाली",
                connectionStatus: "मदत करण्यासाठी तयार",
                restartBtn: "पुन्हा सुरू करा",
                clearChatBtn: "चॅट साफ करा",
                input_placeholder: "तुमची क्वेरी येथे विचारा",
                suggestions_title: "तुम्ही मला विचारू शकता:",
                greeting_response: "नमस्कार! महा आस्था तक्रार निवारण प्रणालीमध्ये आपले स्वागत आहे. आज मी आपल्याला कशी मदत करू शकतो?",
                how_may_help: "आज मी आपल्याला कशी मदत करू शकतो?",
                unknown_question: "मी आपल्याला तिकीट नोंदणी, स्थिती तपासणे किंवा अभिप्राय देण्यासाठी मदत करू शकतो. कृपया वरील सूचनांमधून निवडा किंवा अधिक स्पष्ट करा.",
                welcome: "नमस्कार, महा आस्था तक्रार निवारण प्रणाली एआय-चॅटबॉटमध्ये आपले स्वागत आहे.",
                question1: "महा आस्था तक्रार निवारण प्रणालीमध्ये आपण तिकीट नोंदवू इच्छिता का?",
                question2: "आपण महा आस्था तक्रार निवारण प्रणालीमध्ये नोंदवलेल्या तिकीटची स्थिती तपासू इच्छिता का?",
                question3: "महा आस्था तक्रार निवारण प्रणालीद्वारे सोडविण्यात आलेल्या आपल्या तिकीटच्या निराकरणाबाबत अभिप्राय द्यायला इच्छिता का?",
                register_intro: "आपण महा आस्था तक्रार निवारण प्रणालीमध्ये आपली तिकीट खालील लिंकद्वारे नोंदवू शकता:",
                register_link: "http://172.17.46.11:8001/#grievance",
                ticket_id_prompt: "कृपया स्थिती तपासण्यासाठी आपला तिकीट क्रमांक किंवा मोबाइल नंबर प्रविष्ट करा:",
                ticket_id_input_label: "तिकीट क्रमांक (उदाहरण: TKT-12345678) किंवा मोबाइल नंबर (उदाहरण: 9876543210) प्रविष्ट करा",
                ticket_id_placeholder: "आपला तिकीट क्रमांक किंवा मोबाइल नंबर येथे टाइप करा...",
                invalid_ticket_id: "कृपया वैध तिकीट क्रमांक (उदा. TKT-12345678) किंवा 10-अंकी मोबाइल नंबर (उदा. 9876543210) प्रदान करा.",
                check_status_btn: "तिकीट स्थिती तपासा",
                processing: "प्रक्रिया करत आहे...",
                status_prefix: "आपल्या तिकीटची सद्यस्थिती खालीलप्रमाणे आहे:",
                rating_request: "कृपया आपल्याद्वारे देण्यात आलेले गुण १ ते ५ मध्ये द्या:",
                rating_title: "आमच्या सेवेची गुणवत्ता रेट करा",
                submit_rating: "रेटिंग सबमिट करा",
                submitting: "सबमिट करत आहे...",
                invalid_input: "आपण दिलेली माहिती अवैध आहे. कृपया पुन्हा प्रयत्न करा.",
                thank_you: "महा आस्था तक्रार निवारण प्रणालीचा वापर केल्याबद्दल आपले धन्यवाद.",
                yes: "होय",
                no: "नाही",
                register_button: "तिकीट नोंदवा",
                suggestions_title: "त्वरित सूचना:",
                language_switch_msg: "भाषा मराठी मध्ये बदलली. संवाद पुन्हा सुरू करत आहे...",
                status_details_header: "तिकीट स्थिती तपशील",
                track_ticket_help: "आपण आपल्या तिकीटची स्थिती येथे देखील तपासू शकता: http://172.17.46.11:8001/#view-ticket",
                rating_labels: {
                    1: "खराब",
                    2: "सामान्य",
                    3: "चांगले", 
                    4: "खूप चांगले",
                    5: "उत्कृष्ट"
                },
                suggestions: [
                    "मला तिकीट स्थिती तपासायची आहे",
                    "मला तिकीट नोंदवायची आहे",
                    "मला अभिप्राय द्यायचा आहे"
                ]
            }
        };

        // State Management
        let currentLanguage = 'mr';
        let chatState = 'start';
        let pendingTicketId = '';
        let selectedRating = null;
        let isWindowOpen = false;
        let currentSessionId = null;

        // DOM Elements
        const elements = {
            chatBubble: document.getElementById('chatBubble'),
            chatWindow: document.getElementById('chatWindow'),
            closeChat: document.getElementById('closeChat'),
            chatMessages: document.getElementById('chatMessages'),
            typingIndicator: document.getElementById('typingIndicator'),
            languageSelect: document.getElementById('languageSelect'),
            restartBtn: document.getElementById('restartBtn'),
            clearChatBtn: document.getElementById('clearChatBtn'),
            chatInput: document.getElementById('chatInput'),
            sendBtn: document.getElementById('sendBtn'),
            chatTitle: document.getElementById('chatTitle'),
            connectionStatus: document.getElementById('connectionStatus')
        };

        function updateUILanguage() {
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            document.title = script.pageTitle || 'Maha Aastha';
            if (elements.chatTitle) elements.chatTitle.textContent = script.chatTitle;
            if (elements.connectionStatus) elements.connectionStatus.textContent = script.connectionStatus;
            if (elements.restartBtn) elements.restartBtn.textContent = script.restartBtn;
            if (elements.clearChatBtn) elements.clearChatBtn.textContent = script.clearChatBtn;
            if (elements.chatInput) elements.chatInput.placeholder = script.input_placeholder;
            if (elements.languageSelect) elements.languageSelect.value = currentLanguage;
        }

        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        function isGreetingMessage(message) {
            const lowerMessage = message.toLowerCase();
            const englishGreetings = ['hello', 'hi', 'hey', 'good morning', 'good afternoon', 'good evening', 'greetings', 'howdy', 'hiya', 'sup'];
            const marathiGreetings = ['नमस्कार', 'हॅलो', 'हाय', 'सकाळची नमस्कार', 'दुपारची नमस्कार', 'संध्याकाळची नमस्कार', 'अभिवादन'];
            const allGreetings = [...englishGreetings, ...marathiGreetings];
            return allGreetings.some(greeting => lowerMessage.includes(greeting));
        }

        function getCurrentTime() {
            return new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
        }

        function scrollToBottom() {
            setTimeout(() => {
                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            }, 100);
        }

        function sendUserMessage() {
            const message = elements.chatInput.value.trim();
            if (message) {
                addMessage(message, true);
                elements.chatInput.value = '';
                elements.sendBtn.disabled = true;
                setTimeout(() => { processUserMessage(message); }, 500);
            }
        }

        function processUserMessage(message) {
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            const lowerMessage = message.toLowerCase();
            
            if (chatState === 'awaiting_ticket_id') {
                elements.chatInput.placeholder = script.input_placeholder;
                processTicketId(message);
                return;
            }
            
            const ticketIdPattern = /TKT-[A-Za-z0-9]{8,}/i;
            const mobilePattern = /\b[6-9]\d{9}\b/;
            
            if (ticketIdPattern.test(message) || mobilePattern.test(message)) {
                const identifier = ticketIdPattern.test(message) ? message.match(ticketIdPattern)[0] : message.match(mobilePattern)[0];
                setTimeout(() => {
                    chatState = 'awaiting_ticket_id';
                    processTicketId(identifier);
                }, 500);
                return;
            }
            
            if (isGreetingMessage(message)) {
                setTimeout(() => {
                    addMessage(script.greeting_response, false);
                    setTimeout(() => { showSuggestionsInChat(); }, 1000);
                }, 500);
                return;
            }
            
            if (lowerMessage.includes('status') || lowerMessage.includes('check') || lowerMessage.includes('स्थिती') || lowerMessage.includes('तपास')) {
                setTimeout(() => { showTicketInput(); }, 500);
            } else if (lowerMessage.includes('feedback') || lowerMessage.includes('rating') || lowerMessage.includes('अभिप्राय') || lowerMessage.includes('द्या')) {
                chatState = 'question3';
                setTimeout(() => { addOptionsMessage(script.question3, [script.yes, script.no]); }, 500);
            } else if (lowerMessage.includes('register') || lowerMessage.includes('ticket') || lowerMessage.includes('तिकीट') || lowerMessage.includes('नोंद')) {
                chatState = 'start';
                setTimeout(() => { addOptionsMessage(script.question1, [script.yes, script.no]); }, 500);
            } else {
                setTimeout(() => {
                    addMessage(script.unknown_question, false);
                    setTimeout(() => { showSuggestionsInChat(); }, 1000);
                }, 500);
            }
        }

        function showTypingIndicator() {
            elements.typingIndicator.style.display = 'block';
            scrollToBottom();
        }

        function hideTypingIndicator() {
            elements.typingIndicator.style.display = 'none';
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.innerHTML = `<div class="message-content">${content}<div class="message-time">${getCurrentTime()}</div></div>`;
            elements.chatMessages.insertBefore(messageDiv, elements.typingIndicator);
            scrollToBottom();
        }

        function formatTicketStatus(statusText) {
            const englishPattern = /(?=Ticket ID:|Status:|Created:|Employee Name:|Category:|District:|Office:|Subject:|Last Updated:)/;
            const marathiPattern = /(?=तिकीट क्रमांक:|स्थिती:|दाखल दिनांक:|कर्मचारी नाव:|श्रेणी:|जिल्हा:|कार्यालय:|विषय:|शेवटचा अद्यतन:)/;
            const isMarathi = /[\u0900-\u097F]/.test(statusText);
            let processedText = statusText;
            let parts;
            
            if (isMarathi) {
                parts = processedText.split(marathiPattern);
                if (parts.length <= 1) parts = processedText.split(/\n+|(?=[\u0900-\u097F]+\s*:)/);
            } else {
                parts = processedText.split(englishPattern);
                if (parts.length <= 1) parts = processedText.split(/\n+|(?=\w+\s*:)/);
            }
            
            if (parts.length <= 1) {
                parts = processedText.split(/\n+/);
                if (parts.length <= 1) parts = processedText.split(/(?=\w+:|[\u0900-\u097F]+:)/);
            }
            
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            let formattedStatus = '<div class="grievance-status-container">';
            formattedStatus += `<div class="status-header">${script.status_details_header}</div><div class="status-details">`;
            
            parts.forEach(part => {
                const trimmedPart = part.trim();
                if (trimmedPart && trimmedPart.length > 0) {
                    const colonIndex = trimmedPart.indexOf(':');
                    if (colonIndex !== -1) {
                        const label = trimmedPart.substring(0, colonIndex + 1);
                        const value = trimmedPart.substring(colonIndex + 1).trim();
                        if (label.trim() && value.trim()) {
                            const isStatusField = label.includes('Status:') || label.includes('स्थिती:') || label.toLowerCase().includes('status');
                            const valueClass = isStatusField ? 'status-value highlight' : 'status-value';
                            formattedStatus += `<div class="status-item"><span class="status-label">${label}</span><span class="${valueClass}">${value}</span></div>`;
                            }
                    } else if (trimmedPart.length > 10 && !trimmedPart.includes(':')) {
                        formattedStatus += `<div class="status-item"><span class="status-value" style="width: 100%; text-align: left;">${trimmedPart}</span></div>`;
                    }
                }
            });
            
            formattedStatus += '</div></div>';
            return formattedStatus;
        }
        
        function addOptionsMessage(content, options) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            let optionsHtml = '';
            options.forEach((option, index) => {
                optionsHtml += `<button class="option-button" data-option="${index}">${option}</button>`;
            });
            messageDiv.innerHTML = `<div class="message-content">${content}<div class="pgrs-options">${optionsHtml}</div><div class="message-time">${getCurrentTime()}</div></div>`;
            elements.chatMessages.insertBefore(messageDiv, elements.typingIndicator);
            scrollToBottom();
            messageDiv.querySelectorAll('.option-button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const optionIndex = parseInt(e.target.dataset.option);
                    const optionText = options[optionIndex];
                    addMessage(optionText, true);
                    handleUserChoice(optionIndex);
                });
            });
        }

        function addLinkMessage(content, link) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `<div class="message-content">${content}<br><br><button class="link-button" onclick="window.open('${link}', '_blank')">${MAHA_AASTHA_SCRIPTS[currentLanguage].register_button}</button><div class="message-time">${getCurrentTime()}</div></div>`;
            elements.chatMessages.insertBefore(messageDiv, elements.typingIndicator);
            scrollToBottom();
        }

        function addRatingMessage(content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            const labels = script.rating_labels;
            messageDiv.innerHTML = `
                <div class="message-content">
                    ${content}
                    <div class="rating-container">
                        <div class="rating-title">${script.rating_title}</div>
                        <div class="stars-container" id="starsContainer">
                            ${[1,2,3,4,5].map(num => `
                                <div class="star empty" data-rating="${num}">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.46,13.97L5.82,21L12,17.27Z"/>
                                    </svg>
                                </div>
                            `).join('')}
                        </div>
                        <div class="rating-labels">
                            <span>${labels[1]}</span>
                            <span>${labels[2]}</span>
                            <span>${labels[3]}</span>
                            <span>${labels[4]}</span>
                            <span>${labels[5]}</span>
                        </div>
                        <div class="rating-feedback" id="ratingFeedback"></div>
                        <button class="submit-rating-btn" id="submitRatingBtn" disabled>${script.submit_rating}</button>
                    </div>
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            elements.chatMessages.insertBefore(messageDiv, elements.typingIndicator);
            scrollToBottom();
            setupRatingSystem(messageDiv);
        }

        function setupRatingSystem(container) {
            const stars = container.querySelectorAll('.star');
            const submitBtn = container.querySelector('#submitRatingBtn');
            const feedback = container.querySelector('#ratingFeedback');
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            let currentRating = 0;
            let hoverRating = 0;

            stars.forEach((star, index) => {
                const rating = index + 1;
                star.addEventListener('mouseenter', () => {
                    hoverRating = rating;
                    updateStarDisplay(stars, hoverRating, currentRating, true);
                    showFeedback(feedback, rating, script.rating_labels);
                });
                star.addEventListener('mouseleave', () => {
                    hoverRating = 0;
                    updateStarDisplay(stars, currentRating, currentRating, false);
                    if (currentRating > 0) {
                        showFeedback(feedback, currentRating, script.rating_labels);
                    } else {
                        feedback.textContent = '';
                        feedback.className = 'rating-feedback';
                    }
                });
                star.addEventListener('click', () => {
                    currentRating = rating;
                    selectedRating = rating;
                    updateStarDisplay(stars, currentRating, currentRating, false);
                    showFeedback(feedback, currentRating, script.rating_labels);
                    submitBtn.disabled = false;
                });
            });

            submitBtn.addEventListener('click', async () => {
                if (selectedRating) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = script.submitting;
                    try {
                        await submitRating(selectedRating);
                    } catch (error) {
                        console.error('Failed to submit rating:', error);
                        submitBtn.disabled = false;
                        submitBtn.textContent = script.submit_rating;
                    }
                }
            });
        }

        function updateStarDisplay(stars, rating, currentRating, isHovering) {
            stars.forEach((star, index) => {
                const starRating = index + 1;
                star.className = 'star';
                if (starRating <= rating) {
                    if (isHovering) {
                        star.className += ' hover';
                    } else {
                        star.className += ' filled';
                    }
                } else {
                    star.className += ' empty';
                }
            });
        }

        function showFeedback(feedbackElement, rating, labels) {
            feedbackElement.textContent = labels[rating];
            feedbackElement.className = `rating-feedback rating-${rating}`;
        }

        async function submitRating(rating) {
            try {
                const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
                const response = await fetch(`${API_BASE_URL}/rating/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        rating: rating,
                        session_id: currentSessionId,
                        language: currentLanguage,
                        ticket_id: pendingTicketId || 'NA',
                        feedback_text: document.getElementById('feedbackText')?.value || ''
                    })
                });

                if (response.ok) {
                    setTimeout(() => {
                        addMessage(script.thank_you, false);
                        chatState = 'end';
                        pendingTicketId = '';
                    }, 500);
                } else {
                    throw new Error('Failed to submit rating');
                }
            } catch (error) {
                console.error('Rating submission error:', error);
                addMessage('Sorry, there was an error submitting your rating. Please try again.', false);
                chatState = 'rating';
            }
        }

        function showSuggestionsInChat() {
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'message bot';
            let suggestionsHtml = `<div class="suggestion-message"><div class="suggestion-title">${script.suggestions_title}</div><div class="suggestion-list">`;
            script.suggestions.forEach((suggestion, index) => {
                suggestionsHtml += `<div class="suggestion-item" data-suggestion="${index}">${suggestion}</div>`;
            });
            suggestionsHtml += `</div></div>`;
            suggestionDiv.innerHTML = `<div class="message-content">${suggestionsHtml}<div class="message-time">${getCurrentTime()}</div></div>`;
            elements.chatMessages.insertBefore(suggestionDiv, elements.typingIndicator);
            scrollToBottom();
            suggestionDiv.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const suggestionIndex = parseInt(e.target.dataset.suggestion);
                    const suggestion = script.suggestions[suggestionIndex];
                    handleQuickSuggestion(suggestion);
                });
            });
        }

        function showTicketInput() {
            chatState = 'awaiting_ticket_id';
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            const promptMsg = currentLanguage === 'en' 
                ? "Please enter your Ticket ID (e.g., TKT-12345678) or Mobile Number (e.g., 9876543210) to check status:"
                : "कृपया स्थिती तपासण्यासाठी आपला तिकीट क्रमांक (उदा. TKT-12345678) किंवा मोबाइल नंबर (उदा. 9876543210) प्रविष्ट करा:";
            addMessage(promptMsg, false);
            const placeholderMsg = currentLanguage === 'en' ? "Enter Ticket ID or Mobile Number..." : "तिकीट क्रमांक किंवा मोबाइल नंबर प्रविष्ट करा...";
            elements.chatInput.placeholder = placeholderMsg;
            elements.chatInput.focus();
        }

        async function fetchTicketStatus(ticketId, language) {
            try {
                const response = await fetch(`${API_BASE_URL}/ticket/status/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticket_id: ticketId, language: language })
                });
                const data = await response.json();
                if (response.ok && data.found) {
                    return { success: true, message: data.message };
                } else if (response.status === 404) {
                    return { success: false, message: data.message || "Ticket not found." };
                } else {
                    return { success: false, message: "Sorry, no ticket found with the provided ID. Please check your Ticket ID and try again." };
                }
            } catch (error) {
                console.error("Network error", error);
                return { success: false, message: "Error connecting to server." };
            }
        }

        async function processTicketId(input) {
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            const ticketPattern = /^TKT-[A-Za-z0-9]{6,}$/i;
            const mobilePattern = /^[6-9]\d{9}$/;
            const isValidTicketId = ticketPattern.test(input.trim());
            const isValidMobileNumber = mobilePattern.test(input.replace(/\D/g, ''));
            
            if (!isValidTicketId && !isValidMobileNumber) {
                setTimeout(() => {
                    const errorMsg = currentLanguage === 'en' 
                        ? "Please provide a valid Ticket ID (e.g., TKT-12345678) or 10-digit mobile number (e.g., 9876543210)."
                        : "कृपया वैध तिकीट क्रमांक (उदा. TKT-12345678) किंवा 10-अंकी मोबाइल नंबर (उदा. 9876543210) प्रदान करा.";
                    addMessage(errorMsg, false);
                    setTimeout(() => { showTicketInput(); }, 1500);
                }, 1000);
                return;
            }

            showTypingIndicator();
            try {
                const cleanInput = isValidMobileNumber ? input.replace(/\D/g, '') : input.trim();
                const result = await fetchTicketStatus(cleanInput, currentLanguage);

                if (result.success) {
                    hideTypingIndicator();
                    const formattedStatus = formatTicketStatus(result.message);
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    messageDiv.innerHTML = `<div class="message-content">${formattedStatus}<div class="message-time">${getCurrentTime()}</div></div>`;
                    elements.chatMessages.insertBefore(messageDiv, elements.typingIndicator);
                    scrollToBottom();
                    pendingTicketId = cleanInput;
                    setTimeout(() => {
                        chatState = 'question3';
                        addOptionsMessage(script.question3, [script.yes, script.no]);
                    }, 2000);
                } else {
                    hideTypingIndicator();
                    addMessage(result.message, false);
                    setTimeout(() => { showTicketInput(); }, 1500);
                }
            } catch (error) {
                hideTypingIndicator();
                addMessage("Error connecting to the server. Please try again.", false);
                setTimeout(() => { showTicketInput(); }, 1500);
            }
        }

        function handleQuickSuggestion(suggestion) {
            addMessage(suggestion, true);
            setTimeout(() => { processQuickSuggestion(suggestion); }, 500);
        }

        function processQuickSuggestion(suggestion) {
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            const lowerSuggestion = suggestion.toLowerCase();
            
            if (lowerSuggestion.includes('feedback') || lowerSuggestion.includes('अभिप्राय') || lowerSuggestion.includes('द्यायचा')) {
                chatState = 'question3';
                setTimeout(() => { addOptionsMessage(script.question3, [script.yes, script.no]); }, 500);
                return;
            }
            if (lowerSuggestion.includes('status') || lowerSuggestion.includes('check') || lowerSuggestion.includes('स्थिती') || lowerSuggestion.includes('तपासायची')) {
                setTimeout(() => { showTicketInput(); }, 500);
                return;
            }
            if (lowerSuggestion.includes('register') || lowerSuggestion.includes('ticket') || lowerSuggestion.includes('तिकीट') || lowerSuggestion.includes('नोंदवायची')) {
                chatState = 'start';
                setTimeout(() => { addOptionsMessage(script.question1, [script.yes, script.no]); }, 500);
                return;
            }
            setTimeout(() => {
                addOptionsMessage(script.question1, [script.yes, script.no]);
                chatState = 'start';
            }, 500);
        }

        function handleUserChoice(optionIndex) {
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            switch (chatState) {
                case 'start':
                    if (optionIndex === 0) {
                        setTimeout(() => {
                            addLinkMessage(script.register_intro, script.register_link);
                            setTimeout(() => {
                                addMessage(script.thank_you);
                                chatState = 'end';
                            }, 1000);
                        }, 500);
                    } else {
                        setTimeout(() => {
                            addMessage(script.thank_you);
                            chatState = 'end';
                        }, 500);
                    }
                    break;
                case 'question2':
                    if (optionIndex === 0) {
                        setTimeout(() => { showTicketInput(); }, 500);
                    } else {
                        chatState = 'question3';
                        setTimeout(() => { addOptionsMessage(script.question3, [script.yes, script.no]); }, 500);
                    }
                    break;
                case 'question3':
                    if (optionIndex === 0) {
                        setTimeout(() => {
                            addRatingMessage(script.rating_request);
                            chatState = 'awaiting_rating';
                        }, 500);
                    } else {
                        setTimeout(() => {
                            addMessage(script.thank_you);
                            chatState = 'end';
                        }, 500);
                    }
                    break;
            }
        }

        function toggleChatWindow() {
            isWindowOpen = !isWindowOpen;
            elements.chatWindow.style.display = isWindowOpen ? 'flex' : 'none';
            if (isWindowOpen) {
                if (!currentSessionId) {
                    currentSessionId = generateSessionId();
                }
                if (chatState === 'start' && elements.chatMessages.querySelectorAll('.message').length === 0) {
                    startConversation();
                }
            }
        }

        function startConversation() {
            const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
            const existingMessages = elements.chatMessages.querySelectorAll('.message');
            existingMessages.forEach(msg => msg.remove());
            pendingTicketId = '';
            chatState = 'start';
            setTimeout(() => {
                addMessage(script.welcome, false);
                setTimeout(() => {
                    showSuggestionsInChat();
                    setTimeout(() => {
                        addOptionsMessage(script.question1, [script.yes, script.no]);
                    }, 1000);
                }, 1000);
            }, 500);
        }

        function clearChat() {
            const messages = elements.chatMessages.querySelectorAll('.message, .status-indicator');
            messages.forEach(msg => msg.remove());
            chatState = 'start';
            selectedRating = null;
            pendingTicketId = '';
            currentSessionId = generateSessionId();
        }

        function updateLanguage(langCode) {
            currentLanguage = langCode;
            updateUILanguage();
            if (isWindowOpen && elements.chatMessages.querySelectorAll('.message').length > 0) {
                const script = MAHA_AASTHA_SCRIPTS[currentLanguage];
                addMessage(script.language_switch_msg);
                setTimeout(() => { startConversation(); }, 1000);
            }
        }

        // Event Listeners
        elements.chatBubble.addEventListener('click', toggleChatWindow);
        elements.closeChat.addEventListener('click', toggleChatWindow);
        elements.chatInput.addEventListener('input', function() {
            const hasValue = this.value.trim().length > 0;
            elements.sendBtn.disabled = !hasValue;
        });
        elements.chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !elements.sendBtn.disabled) {
                sendUserMessage();
            }
        });
        elements.sendBtn.addEventListener('click', function() {
            if (!this.disabled) {
                sendUserMessage();
            }
        });
        elements.languageSelect.addEventListener('change', (e) => {
            updateLanguage(e.target.value);
        });
        elements.restartBtn.addEventListener('click', () => {
            startConversation();
        });
        elements.clearChatBtn.addEventListener('click', () => {
            clearChat();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Maha Aastha ChatBot initialized');
            currentSessionId = generateSessionId();
            elements.languageSelect.value = currentLanguage;
            updateUILanguage();
            console.log('Default language set to:', currentLanguage);
        });

        // Additional page functions
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('show');
        }

        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.remove('show');
        }

        function navigateToStatus(event) {
            event.preventDefault();
            window.location.href = 'grievance.html';
        }

        function animateStats() {
            const stats = document.querySelectorAll('.stat-number');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const target = parseInt(entry.target.dataset.target);
                        animateCounter(entry.target, target);
                        observer.unobserve(entry.target);
                    }
                });
            });
            stats.forEach(stat => observer.observe(stat));
        }

        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 100;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current).toLocaleString();
            }, 20);
        }

        // Initialize stats animation
        animateStats();

        console.log('Maha Aastha Portal with Chatbot loaded successfully');
    </script>
</body>
</html>

